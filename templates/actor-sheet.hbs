<form class="nco-sheet" autocomplete="off">
  {{!-- Header --}}
  <header class="sheet-header">
    <div class="header-left">
      <div class="portrait-section">
        <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
      </div>
      <div class="name-bio-section">
        <input type="text" class="character-name" name="name" value="{{actor.name}}" placeholder="Character Name" />
        <input type="text" class="character-bio" name="system.bio" value="{{system.bio}}" placeholder="Short bio..." />
      </div>
    </div>
    <div class="roll-section">
      <button type="button" class="roll-button">
        <i class="fas fa-dice-d6"></i> ROLL
      </button>
    </div>
  </header>

  <div class="sheet-body">
    {{!-- Left Column: Trademarks & Edges --}}
    <div class="column-left">
      <h2 class="section-title">TRADEMARKS & EDGES</h2>
      
      {{#each system.trademarks}}
      <div class="trademark-block">
        <input type="text" 
               class="trademark-input" 
               name="system.trademarks.{{@index}}.name" 
               value="{{this.name}}" 
               placeholder="Trademark {{add @index 1}}" />
        <div class="edges-container">
          {{#each this.edges}}
          <input type="text" 
                 class="edge-input" 
                 name="system.trademarks.{{@../index}}.edges.{{@index}}" 
                 value="{{this}}" 
                 placeholder="Edge {{add @index 1}}" />
          {{/each}}
        </div>
      </div>
      {{/each}}
    </div>

    {{!-- Right Column --}}
    <div class="column-right">
      {{!-- Hits & Stunt Points Row --}}
      <div class="hits-stunt-row">
        {{!-- Hits --}}
        <div class="section hits-section">
          <div class="section-header-row">
            <h3 class="section-title">HITS</h3>
            <div class="row-spacer"></div>
            <div class="button-group">
              <button type="button" class="icon-btn rest-btn" title="Rest (Recover 1 Hit)">
                <i class="fas fa-bed"></i>
              </button>
            </div>
          </div>
          <div class="checkbox-row hits-row">
            {{#each hitsArray}}
            <div class="checkbox hits-checkbox {{#if this.checked}}checked{{/if}}" data-index="{{this.index}}">
              {{#if this.checked}}<i class="fas fa-times"></i>{{/if}}
            </div>
            {{/each}}
            {{!-- 4th hit box - locked until upgraded --}}
            {{#unless hitsMaxed}}
            <div class="checkbox hits-checkbox disabled locked" title="Upgrade required">
              <i class="fas fa-lock"></i>
            </div>
            {{/unless}}
          </div>
        </div>

        {{!-- Stunt Points --}}
        <div class="section stunt-section">
          <div class="section-header-row">
            <h3 class="section-title">STUNT POINTS</h3>
            <div class="row-spacer"></div>
            <div class="button-group">
              <button type="button" class="icon-btn bonus-stunt-btn" title="Bonus Stunt (+1)">
                <i class="fas fa-plus"></i>
              </button>
              <button type="button" class="icon-btn refresh-stunt-btn" title="Refresh Stunt Points">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
          </div>
          <div class="checkbox-row stunt-row">
            {{#each stuntArray}}
            <div class="checkbox stunt-checkbox {{#if this.checked}}checked{{/if}}" data-index="{{this.index}}">
              {{#if this.checked}}<i class="fas fa-check"></i>{{/if}}
            </div>
            {{/each}}
            {{!-- Locked stunt boxes - show remaining until max 5 --}}
            {{#each lockedStuntArray}}
            <div class="checkbox stunt-checkbox disabled locked" title="Upgrade required">
              <i class="fas fa-lock"></i>
            </div>
            {{/each}}
          </div>
        </div>
      </div>

      {{!-- Conditions --}}
      <div class="section">
        <h3 class="section-title">CONDITIONS</h3>
        <div class="conditions-grid">
          {{#each conditionsList}}
          <label class="condition-item">
            <input type="checkbox" class="condition-checkbox" data-condition="{{this.key}}" {{#if this.checked}}checked{{/if}} />
            <span class="condition-label">{{this.label}}</span>
          </label>
          {{/each}}
          {{!-- Custom Condition (7th) --}}
          <label class="condition-item custom-condition">
            <input type="checkbox" class="condition-checkbox" data-condition="custom" {{#if system.conditions.custom}}checked{{/if}} />
            <input type="text" class="custom-condition-input" name="system.customCondition" value="{{system.customCondition}}" placeholder="Custom..." />
          </label>
        </div>
      </div>

      {{!-- Traumas --}}
      <div class="section traumas-section">
        <div class="section-header-row">
          <h3 class="section-title">TRAUMAS</h3>
          <div class="row-spacer"></div>
          <div class="button-group">
            <button type="button" class="icon-btn recovery-roll-btn" title="Recovery Roll">
              <i class="fas fa-heart"></i>
            </button>
            <button type="button" class="icon-btn trauma-roll-btn" title="Trauma Roll">
              <i class="fas fa-skull"></i>
            </button>
          </div>
        </div>
        <div class="input-column">
          {{#each system.traumas}}
          <input type="text" name="system.traumas.{{@index}}" value="{{this}}" placeholder="Trauma {{add @index 1}}" />
          {{/each}}
        </div>
      </div>

      {{!-- Flaws --}}
      <div class="section flaws-section">
        <h3 class="section-title">FLAWS</h3>
        <div class="input-column">
          {{#each system.flaws}}
          <input type="text" name="system.flaws.{{@index}}" value="{{this}}" placeholder="Flaw {{add @index 1}}" />
          {{/each}}
        </div>
      </div>

      {{!-- Gear --}}
      <div class="section">
        <h3 class="section-title">GEAR</h3>
        <textarea name="system.gear" placeholder="Equipment list...">{{system.gear}}</textarea>
      </div>

      {{!-- Special Gear --}}
      <div class="section special-gear-section">
        <h3 class="section-title">SPECIAL GEAR</h3>
        <div class="input-column">
          {{#each system.specialGear}}
          <input type="text" name="system.specialGear.{{@index}}" value="{{this}}" placeholder="Special Gear {{add @index 1}}" />
          {{/each}}
        </div>
      </div>

      {{!-- Stash (Leverage) --}}
      <div class="section stash-section">
        <div class="section-header-row stash-header">
          <h3 class="section-title">STASH</h3>
          <div class="row-spacer"></div>
          <div class="button-group">
            <button type="button" class="icon-btn gain-leverage-btn" title="Gain Leverage (D3)">
              <i class="fas fa-dice-d6"></i>
            </button>
            <button type="button" class="icon-btn bonus-leverage-btn" title="Bonus Leverage (+1)">
              <i class="fas fa-plus"></i>
            </button>
            <button type="button" class="icon-btn spend-leverage-btn" title="Spend Leverage">
              <i class="fas fa-coins"></i>
            </button>
          </div>
        </div>
        <div class="checkbox-row stash-row">
          {{#each stashArray}}
          <div class="checkbox stash-checkbox display-only {{#if this.checked}}checked{{/if}}">
            {{#if this.checked}}<i class="fas fa-check"></i>{{/if}}
          </div>
          {{/each}}
        </div>
      </div>

      {{!-- Drive --}}
      <div class="section">
        <div class="section-header-row drive-header">
          <h3 class="section-title">DRIVE</h3>
          <div class="row-spacer"></div>
          <div class="button-group">
            <button type="button" class="icon-btn retire-btn" title="Retire Character">
              <i class="fas fa-door-open"></i>
            </button>
          </div>
        </div>
        <div class="checkbox-row drive-row">
          {{#each driveArray}}
          <div class="checkbox tristate drive-checkbox state-{{tristate this.state}}" data-index="{{this.index}}">
            {{#if (eq this.state 1)}}<i class="fas fa-check"></i>{{/if}}
            {{#if (eq this.state 2)}}<i class="fas fa-times"></i>{{/if}}
          </div>
          {{/each}}
        </div>
        <input type="text" class="drive-note" name="system.driveNote" value="{{system.driveNote}}" placeholder="Drive description..." />
        <div class="hint">(Click to cycle: ○ → ✓ → ✗)</div>
      </div>

      {{!-- Experience --}}
      <div class="section experience-section">
        <div class="section-header-row">
          <h3 class="section-title">EXPERIENCE</h3>
          <div class="row-spacer"></div>
          <div class="button-group">
            <button type="button" class="icon-btn mark-xp-btn" title="Mark Experience (+1)">
              <i class="fas fa-plus"></i>
            </button>
            <button type="button" class="icon-btn advancement-btn" title="Advancement (costs 5 XP)">
              <i class="fas fa-arrow-up"></i>
            </button>
          </div>
        </div>
        <div class="experience-container">
          {{#each expBlocks}}
          <div class="exp-block">
            {{#each this.checkboxes}}
            <div class="checkbox exp-checkbox display-only {{#if this.checked}}checked{{/if}}">
              {{#if this.checked}}<i class="fas fa-check"></i>{{/if}}
            </div>
            {{/each}}
          </div>
          {{/each}}
        </div>
        <div class="hint">(3 blocks × 5 XP)</div>
      </div>
    </div>
  </div>

  <footer class="sheet-footer">
    NEON CITY OVERDRIVE • FoundryVTT v13
  </footer>
</form>
